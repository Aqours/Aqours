<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Page</title>
</head>
<body>

<img src="../images/album.jpg" alt="album" hidden>
<canvas width="500" height="500"></canvas>

<script>
    const canvas = document.querySelector('canvas');
    const context = canvas.getContext('2d');
    const isEqualView = (buf1, buf2) => buf1.byteLength === buf2.byteLength && buf1.every((value, index) => value === buf2[index]);
    const img = document.querySelector('img');
    function checkCanvasFrames(canvas) {
        let count = 0;
        let fragment = [];
        let timerId = setInterval(function () {
            count++;
            if (count > 50) { // sample size
                clearInterval(timerId);
                return;
            }
            try {
                const imgData = context.getImageData(0, 0, canvas.width, canvas.height);
                if (fragment.length) {
                    // compare view data
                    console.log(isEqualView(fragment[fragment.length - 1].data, imgData.data));
                }
                fragment.push(imgData);
            } catch (e) {
                clearInterval(timerId);
                e.message && console.warn(e.message);
            }
        }, 10);
    }
    img.onload = function () {
        const ONE_TURN = Math.PI * 2;
        const MAX_LENGTH = Math.max(img.width, img.height);
        const HALF_LENGTH = MAX_LENGTH / 2;
        canvas.width = canvas.height = MAX_LENGTH;
        context.fillStyle = context.createPattern(img, 'no-repeat');
        context.arc(HALF_LENGTH, HALF_LENGTH, HALF_LENGTH, 0, ONE_TURN);
        context.clearRect(0, 0, MAX_LENGTH, MAX_LENGTH);
        context.fill();
        checkCanvasFrames(canvas); // first
    };
</script>

</body>
</html>